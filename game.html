<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>철자 게임</title>
  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background: #0f172a;
      color: white;
    }
    #track {
      position: relative;
      width: 100%;
      height: 300px; /* 게임 영역 크게 */
      border-top: 2px solid #334155;
      border-bottom: 2px solid #334155;
      margin-top: 40px;
      overflow: hidden;
    }
    .letter {
      position: absolute;
      font-size: 2.5rem;
      font-weight: bold;
      top: 50%;
      transform: translateY(-50%);
      white-space: nowrap;
    }
    .back-btn {
      position: fixed;
      top: 12px;
      right: 12px;
      background:#334155;
      color:#fff;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,.25);
      z-index: 1000;
    }
    .back-btn:hover{ background:#1f2937; }

    .feedback{
      position: fixed;
      top: 22%;
      left: 50%;
      transform: translateX(-50%);
      display:none;
      padding:12px 20px;
      border-radius:12px;
      font-size:2rem;
      font-weight:800;
      color:#fff;
      background:rgba(0,0,0,.6);
      box-shadow:0 8px 24px rgba(0,0,0,.35);
      z-index: 1000;
      user-select:none;
    }
    .feedback.show{ display:block; }
    .feedback.ok{ background: rgba(16,185,129,.9);}  /* 초록 */
    .feedback.no{ background: rgba(239,68,68,.9);}    /* 빨강 */
  </style>
</head>
<body>
  <button id="backBtn" class="back-btn">처음으로</button>
  <div id="track"></div>
  <div id="feedback" class="feedback" aria-live="polite"></div>

  <!-- 효과음 -->
  <audio id="sound-ok" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="sound-no" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

  <script>
    const track = document.getElementById('track');
    const feedback = document.getElementById('feedback');
    const soundOk = document.getElementById('sound-ok');
    const soundNo = document.getElementById('sound-no');

    // 샘플 문제 단어
    const words = ["banana", "apple", "cherry"];
    let currentWord = "";
    let currentLetters = [];
    let speed = 500; // px/s
    let rafId = null;

    function showFeedback(message, isCorrect){
      feedback.textContent = message;
      feedback.classList.remove('ok','no','show');
      feedback.classList.add(isCorrect ? 'ok' : 'no','show');
      if(isCorrect){ soundOk.currentTime=0; soundOk.play(); }
      else { soundNo.currentTime=0; soundNo.play(); }
      setTimeout(()=> feedback.classList.remove('show'), 1500);
    }

    function startWord(word){
      track.innerHTML = "";
      currentLetters = [];

      // 글자별 span 생성
      [...word].forEach((ch, i)=>{
        const span = document.createElement('span');
        span.className="letter";
        span.textContent = ch;

        // 방향 랜덤
        const fromLeft = Math.random()<0.5;
        const startX = fromLeft ? -50 : track.clientWidth + 50;
        const endX = fromLeft ? track.clientWidth + 50 : -50;

        // Y 좌표도 랜덤
        const posY = 50 + (Math.random()*60-30);

        span.style.left = startX + "px";
        span.style.top = posY + "%";
        track.appendChild(span);

        currentLetters.push({el:span, startX, endX, startTime:null, duration: track.clientWidth/speed*1000 });
      });

      rafId = requestAnimationFrame(tick);
    }

    function tick(timestamp){
      let done = true;
      currentLetters.forEach(l=>{
        if(!l.startTime) l.startTime = timestamp;
        const progress = (timestamp-l.startTime)/l.duration;
        if(progress<1){
          done=false;
          const x = l.startX + (l.endX-l.startX)*progress;
          l.el.style.left = x+"px";
        } else {
          l.el.style.left = l.endX+"px";
        }
      });
      if(!done) rafId=requestAnimationFrame(tick);
    }

    // 정답/오답 시뮬레이션 (Enter = 정답, Esc = 오답)
    document.addEventListener('keydown', e=>{
      if(e.key==="Enter"){
        showFeedback("정답입니다!", true);
        cancelAnimationFrame(rafId);
        setTimeout(()=>startWord(words[Math.floor(Math.random()*words.length)]),1000);
      }
      if(e.key==="Escape"){
        showFeedback("틀렸습니다!", false);
        speed = Math.max(speed*0.9,100);
        cancelAnimationFrame(rafId);
        setTimeout(()=>startWord(currentWord),1000);
      }
    });

    // 처음으로 버튼
    document.getElementById('backBtn').addEventListener('click', ()=>{
      location.href="join.html";
    });

    // 시작
    currentWord = words[0];
    startWord(currentWord);
  </script>
</body>
</html>
